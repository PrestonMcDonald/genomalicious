dat[, MISS:=as.integer(!is.na(RESP))]
(ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus')
)
(ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ facet_grid(~POP, scale='free_y')
+ labs(x='Samples', y='Locus')
)
(ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ facet_wrap(~POP, scale='free_y')
+ labs(x='Samples', y='Locus')
)
(ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ facet_grid(~POP, space='free_y')
+ labs(x='Samples', y='Locus')
)
# If population column is specified, make indiviudal plot
# for each population
ggLs <- lapply(unique(dat$POP), function(pop){
g <- (ggplot(dat[POP==pop], aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,plot.title=element_text(hjust=0.5, size=12, face='bold')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus', title=pop)
)
return(g)
})
gg
gg <- do.call('grid.arrange', c(ggLs, ncol=plotNCol))
gg
lapply(gg, class)
popCOl
popCol
popCol <- NA
popCol==NA
is.na(popCol)
is.na(popCol)==TRUE
data(genomalicious_4pops)
datGt <- genomalicious_4pops
missIdx <- c(sample(1:nrow(datGt), size=0.05*nrow(datGt), replace=FALSE)
datGt$GT[missIdx] <- NA
missIdx <- c(sample(1:nrow(datGt), size=0.05*nrow(datGt), replace=FALSE)
, 100:500, 800:1200, 8000:8888, 200000:200500)
datGt$GT[missIdx] <- NA
#' missIdx <- c(sample(1:nrow(datGt), size=0.05*nrow(datGt), replace=FALSE)
#'              , 100:500, 800:1200, 8000:8888, 200000:200500)
#'
#' datGt$GT[missIdx] <- NA
#'
#'
#'
#' ####   MISSING FREQUENCY DATA   ####
#'
#' @export
plot_missBYsamps <- function(dat, type='hist', look='ggplot'
, sampCol='SAMPLE', locusCol='LOCUS'
, respCol='GT', popCol=NA
, plotColours='white', plotNCol=2){
# --------------------------------------------+
# Libraries, assertions, and setup
# --------------------------------------------+
for(lib in c('ggplot2', 'data.table','gridExtra')){ require(lib, character.only = TRUE)}
# Rename columns
colnames(dat)[
match(c(locusCol, respCol, sampCol), colnames(dat))
] <- c('LOCUS', 'RESP', 'SAMPLE')
# Rename the population column, if it was specified
if(is.na(popCol)==FALSE){
colnames(dat)[which(colnames(dat)==popCol)] <- 'POP'
}
# Set the plot theme by look
if(look=='ggplot'){
plotTheme <- theme_gray() + theme(legend.position='top'
, text=element_text(size=12))
} else if(look=='classic'){
plotTheme <- theme_bw() + theme(panel.grid.major=element_blank()
, panel.grid.minor=element_blank()
, text=element_text(colour='black', size=12)
, legend.position='top')
}
# --------------------------------------------+
# Code
# --------------------------------------------+
# Histogram
if(type=='hist'){
# If
if(is.na(popCol)){
# If no population column is specified (NA)
stats <- dat[, sum(is.na(RESP)), by=SAMPLE]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples'))
} else{
# If population column is specified, facet plot by population
stats <- dat[, sum(is.na(RESP)), by=c('SAMPLE', 'POP')]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme + theme(strip.text.x=element_text(face='bold'))
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples')
+ facet_wrap(~ POP, ncol=plotNCol))
}
}
# Heat map
if(type=='heatmap'){
# Make two colours, if only ine specified
if(length(plotColours)<=1){
plotColours <- c('white', 'royalblue')
}
# Assign a new column to record missing data
dat[, MISS:=as.integer(!is.na(RESP))]
if(is.na(popCol)){
# If no population column is specified (NA)
gg <- (ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus')
)
} else {
# If population column is specified, make indiviudal plot
# for each population
ggLs <- lapply(unique(dat$POP), function(pop){
g <- (ggplot(dat[POP==pop], aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,plot.title=element_text(hjust=0.5, size=12, face='bold')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus', title=pop)
)
return(g)
})
gg <- do.call('grid.arrange', c(ggLs, ncol=plotNCol))
}
}
# FInish up
plot(gg)
return(gg)
}
head(datGt)
data(genomalicious_4pops)
datGt <- genomalicious_4pops
# Add missing values
missIdx <- c(sample(1:nrow(datGt), size=0.05*nrow(datGt), replace=FALSE)
, 100:500, 800:1200, 8000:8888, 200000:200500)
datGt$GT[missIdx] <- NA
head(datGt)
datGt
head(datGt, 10)
plot_missBYsamps(datGt, type='hist', look='ggplot')
plot_missBYsamps(datGt, type='hist', look='classic')
plot_missBYsamps(datGt, type='hist', look='ggplot', popCol='POP)
')'
plot_missBYsamps(datGt, type='hist', look='ggplot', popCol='POP')
, plotColours='goldenrod4')
plot_missBYsamps(datGt, type='hist', look='ggplot', popCol='POP'
, plotColours='goldenrod4')
, plotColours='royalblue')
plot_missBYsamps(datGt, type='hist', look='ggplot', popCol='POP'
, plotColours='royalblue')
, popCol='POP' , plotColours='plum2')
plot_missBYsamps(datGt, type='hist', look='ggplot'
, popCol='POP' , plotColours='plum2')
plot_missBYsamps(datGt, type='heatmap')
plot_missBYsamps(datGt, type='heatmap', plotColours=c('black', 'plum2'))
plot_missBYsamps(datGt, type='heatmap', popCol='POP')
roxygenise('./', clean=TRUE)
library(genomalicious)
?plot_missBYsamps
roxygenise('./', clean=TRUE)
library(genomalicious)
libs <- c('devtools', 'roxygen2', 'testthat', 'knitr')
for(L in libs){require(L, character.only=T)}
roxygenise('./', clean=TRUE)
libs <- c('devtools', 'roxygen2', 'testthat', 'knitr')
for(L in libs){require(L, character.only=T)}
data(genomalicious_Pi)
genomalicious::genomalicious_PoolPi
data(genomalicious_PoolPi)
data(genomalicious_Freqs)
genomalicious_Freqs
genomalicious_FreqsLong
data(genomalicious_FreqsLong)
genomalicious_FreqsLong
freqDat <- genomalicious_FreqsLong
setnames(freqDat, POP, SAMPLE)
setnames(freqDat, 'POP', 'SAMPLE')
freqDat
plot_missBYsampls(freqDat)
#' freqDat <- genomalicious_FreqsLong
#' setnames(freqDat, 'POP', 'SAMPLE')
#'
#' freqDat
#'
#' plot_missBYsampls(freqDat)
#'
#' ####   CATCH PLOT OUTPUT FOR LATER USE   ####
#'
#' @export
plot_missBYsamps <- function(dat, type='hist', look='ggplot'
, sampCol='SAMPLE', locusCol='LOCUS'
, respCol='GT', popCol=NA
, plotColours='white', plotNCol=2){
# --------------------------------------------+
# Libraries, assertions, and setup
# --------------------------------------------+
for(lib in c('ggplot2', 'data.table','gridExtra')){ require(lib, character.only = TRUE)}
# Rename columns
colnames(dat)[
match(c(locusCol, respCol, sampCol), colnames(dat))
] <- c('LOCUS', 'RESP', 'SAMPLE')
# Rename the population column, if it was specified
if(is.na(popCol)==FALSE){
colnames(dat)[which(colnames(dat)==popCol)] <- 'POP'
}
# Set the plot theme by look
if(look=='ggplot'){
plotTheme <- theme_gray() + theme(legend.position='top'
, text=element_text(size=12))
} else if(look=='classic'){
plotTheme <- theme_bw() + theme(panel.grid.major=element_blank()
, panel.grid.minor=element_blank()
, text=element_text(colour='black', size=12)
, legend.position='top')
}
# --------------------------------------------+
# Code
# --------------------------------------------+
# Histogram
if(type=='hist'){
# If
if(is.na(popCol)){
# If no population column is specified (NA)
stats <- dat[, sum(is.na(RESP)), by=SAMPLE]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples'))
} else{
# If population column is specified, facet plot by population
stats <- dat[, sum(is.na(RESP)), by=c('SAMPLE', 'POP')]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme + theme(strip.text.x=element_text(face='bold'))
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples')
+ facet_wrap(~ POP, ncol=plotNCol))
}
}
# Heat map
if(type=='heatmap'){
# Make two colours, if only ine specified
if(length(plotColours)<2){
plotColours <- c('white', 'royalblue')
}
# Assign a new column to record missing data
dat[, MISS:=as.integer(!is.na(RESP))]
if(is.na(popCol)){
# If no population column is specified (NA)
gg <- (ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus')
)
} else {
# If population column is specified, make indiviudal plot
# for each population
ggLs <- lapply(unique(dat$POP), function(pop){
g <- (ggplot(dat[POP==pop], aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,plot.title=element_text(hjust=0.5, size=12, face='bold')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus', title=pop)
)
return(g)
})
gg <- do.call('grid.arrange', c(ggLs, ncol=plotNCol))
}
}
# FInish up
plot(gg)
return(gg)
}
plot_missBYsampls(freqDat)
plot_missBYsamps(freqDat)
freqDat <- genomalicious_FreqsLong
freqDat
freqDat <- genomalicious_FreqsLong
freqDat
rm(freqDat)
rm(genomalicious_FreqsLong)
freqDat <- genomalicious_FreqsLong
data(genomalicious_FreqsLong)
freqDat <- genomalicious_FreqsLong
freqDat
plot_missBYsamps(freqDat, sampCol='POP', respCol='FREQ')
plot_missBYsamps(freqDat, type='heatmap', sampCol='POP', respCol='FREQ')
?sample
missFreqs <- sample(1:nrow(freqDat), size=10, replace=FALSE)
plot_missBYsamps(freqDat, type='heatmap', sampCol='POP', respCol='FREQ')
sample(1:nrow(freqDat), size=10, replace=FALSE)
missFreqs <- sample(1:nrow(freqDat), size=15, replace=FALSE)
freqDat$FREQS[missFreqs] <- NA
freqDat
data(genomalicious_FreqsLong)
freqDat <- genomalicious_FreqsLong
missFreqs <- sample(1:nrow(freqDat), size=15, replace=FALSE)
freqDat$FREQ[missFreqs] <- NA
freqDat
plot_missBYsamps(freqDat, type='heatmap', sampCol='POP', respCol='FREQ')
, respCol='FREQ', popCol='POP')
plot_missBYsamps(freqDat, type='heatmap', sampCol='POP'
, respCol='FREQ', popCol='POP')
libs <- c('devtools', 'roxygen2', 'testthat', 'knitr')
for(L in libs){require(L, character.only=T)}
#' # Heatmaps, default and specified colours
#' plot_missBYsamps(datGt, type='heatmap')
#' plot_missBYsamps(datGt, type='heatmap', plotColours=c('black', 'plum2'))
#'
#' # Heatmaps, by population
#' plot_missBYsamps(datGt, type='heatmap', popCol='POP')
#'
#' ####   CATCH PLOT OUTPUT FOR LATER USE   ####
#'
#' @export
plot_missBYsamps <- function(dat, type='hist', look='ggplot'
, sampCol='SAMPLE', locusCol='LOCUS'
, genoCol='GT', popCol=NA
, plotColours='white', plotNCol=2){
# --------------------------------------------+
# Libraries, assertions, and setup
# --------------------------------------------+
for(lib in c('ggplot2', 'data.table','gridExtra')){ require(lib, character.only = TRUE)}
# Rename columns
colnames(dat)[
match(c(locusCol, genoCol, sampCol), colnames(dat))
] <- c('LOCUS', 'GT', 'SAMPLE')
# Rename the population column, if it was specified
if(is.na(popCol)==FALSE){
colnames(dat)[which(colnames(dat)==popCol)] <- 'POP'
}
# Set the plot theme by look
if(look=='ggplot'){
plotTheme <- theme_gray() + theme(legend.position='top'
, text=element_text(size=12))
} else if(look=='classic'){
plotTheme <- theme_bw() + theme(panel.grid.major=element_blank()
, panel.grid.minor=element_blank()
, text=element_text(colour='black', size=12)
, legend.position='top')
}
# --------------------------------------------+
# Code
# --------------------------------------------+
# Histogram
if(type=='hist'){
# If
if(is.na(popCol)){
# If no population column is specified (NA)
stats <- dat[, sum(is.na(GT)), by=SAMPLE]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples'))
} else{
# If population column is specified, facet plot by population
stats <- dat[, sum(is.na(GT)), by=c('SAMPLE', 'POP')]
gg <- (ggplot(stats, aes(x=V1))
+ plotTheme + theme(strip.text.x=element_text(face='bold'))
+ geom_histogram(fill=plotColours[1], colour='black')
+ labs(x='Missing data', y='Number of samples')
+ facet_wrap(~ POP, ncol=plotNCol))
}
}
# Heat map
if(type=='heatmap'){
# Make two colours, if only ine specified
if(length(plotColours)<2){
plotColours <- c('white', 'royalblue')
}
# Assign a new column to record missing data
dat[, MISS:=as.integer(!is.na(GT))]
if(is.na(popCol)){
# If no population column is specified (NA)
gg <- (ggplot(dat, aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus')
)
} else {
# If population column is specified, make indiviudal plot
# for each population
ggLs <- lapply(unique(dat$POP), function(pop){
g <- (ggplot(dat[POP==pop], aes(x=SAMPLE, y=LOCUS))
+ theme(
axis.text.x = element_blank()
,axis.text.y = element_blank()
,axis.ticks = element_blank()
,panel.border=element_rect(fill=NA, colour='black')
,plot.title=element_text(hjust=0.5, size=12, face='bold')
,legend.position='none'
)
+ geom_tile(aes(fill=as.factor(MISS)), colour=NA)
+ scale_fill_manual(values=c('0'=plotColours[1], '1'=plotColours[2]))
+ labs(x='Samples', y='Locus', title=pop)
)
return(g)
})
gg <- do.call('grid.arrange', c(ggLs, ncol=plotNCol))
}
}
# FInish up
plot(gg)
return(gg)
}
data(genomalicious_4pops)
datGt <- genomalicious_4pops
missIdx <- c(sample(1:nrow(datGt), size=0.05*nrow(datGt), replace=FALSE)
, 100:500, 800:1200, 8000:8888, 200000:200500)
datGt$GT[missIdx] <- NA
head(datGt, 10)
plot_missBYsamps(datGt, type='hist', look='ggplot')
plot_missBYsamps(datGt, type='hist', look='classic')
plot_missBYsamps(datGt, type='hist', look='ggplot'
, popCol='POP' , plotColours='plum2')
plot_missBYsamps(datGt, type='heatmap')
plot_missBYsamps(datGt, type='heatmap', plotColours=c('black', 'plum2'))
plot_missBYsamps(datGt, type='heatmap', popCol='POP')
gg4pops <- plot_missBYsamps(datGt, popCol='POP')
gg4pop + geom_histogram(mapping=aes(fill='POP'))
gg4pops <- plot_missBYsamps(datGt, popCol='POP')
gg4pop + geom_histogram(mapping=aes(fill='POP'))
gg4pops + geom_histogram(mapping=aes(fill='POP'))
plot(gg4pops)
roxygenise('./', clean=TRUE)
library(genomalicious)
?plot_missBYsamps
